<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>E-Commerce Functions Test - Gigies</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      padding: 2rem;
      background: #f5f5f5;
      max-width: 1200px;
      margin: 0 auto;
    }
    .test-card {
      background: white;
      border-radius: 12px;
      padding: 2rem;
      margin-bottom: 1.5rem;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    h1 {
      color: #2563eb;
      margin-bottom: 0.5rem;
    }
    h2 {
      color: #1e40af;
      margin-bottom: 1rem;
      border-bottom: 2px solid #e5e7eb;
      padding-bottom: 0.5rem;
    }
    .test-btn {
      background: #2563eb;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
      margin: 0.5rem 0.5rem 0.5rem 0;
      transition: all 0.2s;
    }
    .test-btn:hover {
      background: #1d4ed8;
      transform: translateY(-2px);
    }
    .test-btn.success {
      background: #059669;
    }
    .test-btn.error {
      background: #dc2626;
    }
    .result {
      background: #f3f4f6;
      padding: 1rem;
      border-radius: 8px;
      margin-top: 1rem;
      font-family: monospace;
      font-size: 14px;
      white-space: pre-wrap;
      max-height: 400px;
      overflow-y: auto;
    }
    .status {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
      margin-left: 0.5rem;
    }
    .status.ok {
      background: #d1fae5;
      color: #065f46;
    }
    .status.fail {
      background: #fee2e2;
      color: #991b1b;
    }
    .status.pending {
      background: #fef3c7;
      color: #92400e;
    }
    .info {
      background: #dbeafe;
      padding: 1rem;
      border-radius: 8px;
      border-left: 4px solid #2563eb;
      margin: 1rem 0;
    }
  </style>
</head>
<body>
  <div class="test-card">
    <h1>ğŸ§ª Gigies E-Commerce Functions Test</h1>
    <p>This page tests all e-commerce functions and API endpoints.</p>
  </div>

  <!-- Function Tests -->
  <div class="test-card">
    <h2>1ï¸âƒ£ JavaScript Functions Test</h2>
    <button class="test-btn" onclick="testFunctions()">ğŸ” Test All Functions</button>
    <div id="functionResult" class="result" style="display: none;"></div>
  </div>

  <!-- API Tests -->
  <div class="test-card">
    <h2>2ï¸âƒ£ API Endpoints Test</h2>
    <button class="test-btn" onclick="testAPIs()">ğŸŒ Test All APIs</button>
    <div id="apiResult" class="result" style="display: none;"></div>
  </div>

  <!-- Database Tests -->
  <div class="test-card">
    <h2>3ï¸âƒ£ Database Tables Test</h2>
    <button class="test-btn" onclick="testDatabase()">ğŸ—„ï¸ Test Database</button>
    <div id="dbResult" class="result" style="display: none;"></div>
  </div>

  <!-- Integration Test -->
  <div class="test-card">
    <h2>4ï¸âƒ£ Full Integration Test</h2>
    <button class="test-btn" onclick="runFullTest()">ğŸš€ Run Full Test</button>
    <div id="fullResult" class="result" style="display: none;"></div>
  </div>

  <!-- Quick Actions -->
  <div class="test-card">
    <h2>âš¡ Quick Actions</h2>
    <button class="test-btn" onclick="addTestProduct()">â• Add Test Product</button>
    <button class="test-btn" onclick="addTestCategory()">ğŸ“‚ Add Test Category</button>
    <button class="test-btn" onclick="listProducts()">ğŸ“‹ List All Products</button>
    <button class="test-btn" onclick="listCategories()">ğŸ“‹ List All Categories</button>
    <div id="actionResult" class="result" style="display: none;"></div>
  </div>

  <!-- Info Box -->
  <div class="info">
    <strong>â„¹ï¸ Usage:</strong><br>
    1. Click each test button in order<br>
    2. Check for âœ… (success) or âŒ (error)<br>
    3. View detailed results in the boxes below<br>
    4. All tests should pass for full functionality
  </div>

  <script>
    const API_BASE = '';

    // Test 1: JavaScript Functions
    async function testFunctions() {
      const result = document.getElementById('functionResult');
      result.style.display = 'block';
      let output = 'ğŸ§ª Testing JavaScript Functions...\n\n';

      const tests = [
        { name: 'switchToTab', fn: () => typeof switchToTab },
        { name: 'loadProducts', fn: () => typeof loadProducts },
        { name: 'loadCategories', fn: () => typeof loadCategories },
        { name: 'loadOrders', fn: () => typeof loadOrders },
        { name: 'loadStoreSettings', fn: () => typeof loadStoreSettings },
        { name: 'showAddProductModal', fn: () => typeof showAddProductModal },
        { name: 'showAddCategoryModal', fn: () => typeof showAddCategoryModal },
        { name: 'saveProduct', fn: () => typeof saveProduct },
        { name: 'saveCategory', fn: () => typeof saveCategory },
        { name: 'loadEcommerceTab', fn: () => typeof window.loadEcommerceTab }
      ];

      let passed = 0;
      let failed = 0;

      tests.forEach(test => {
        try {
          const result = test.fn();
          if (result === 'function') {
            output += `âœ… ${test.name}: DEFINED\n`;
            passed++;
          } else {
            output += `âŒ ${test.name}: NOT FOUND (${result})\n`;
            failed++;
          }
        } catch (error) {
          output += `âŒ ${test.name}: ERROR - ${error.message}\n`;
          failed++;
        }
      });

      output += `\nğŸ“Š Results: ${passed} passed, ${failed} failed`;
      result.textContent = output;
    }

    // Test 2: API Endpoints
    async function testAPIs() {
      const result = document.getElementById('apiResult');
      result.style.display = 'block';
      let output = 'ğŸŒ Testing API Endpoints...\n\n';

      const endpoints = [
        { name: 'GET Products', url: '/api/ecommerce/products' },
        { name: 'GET Categories', url: '/api/ecommerce/categories' },
        { name: 'GET Orders', url: '/api/ecommerce/orders' },
        { name: 'GET Settings', url: '/api/ecommerce/settings' }
      ];

      let passed = 0;
      let failed = 0;

      for (const endpoint of endpoints) {
        try {
          const response = await fetch(API_BASE + endpoint.url);
          const data = await response.json();
          
          if (response.ok && data.success !== false) {
            output += `âœ… ${endpoint.name}: ${response.status} OK\n`;
            output += `   Data: ${JSON.stringify(data).substring(0, 100)}...\n\n`;
            passed++;
          } else {
            output += `âŒ ${endpoint.name}: ${response.status} FAILED\n`;
            output += `   Error: ${data.message || 'Unknown error'}\n\n`;
            failed++;
          }
        } catch (error) {
          output += `âŒ ${endpoint.name}: NETWORK ERROR\n`;
          output += `   ${error.message}\n\n`;
          failed++;
        }
      }

      output += `ğŸ“Š Results: ${passed} passed, ${failed} failed`;
      result.textContent = output;
    }

    // Test 3: Database Tables
    async function testDatabase() {
      const result = document.getElementById('dbResult');
      result.style.display = 'block';
      let output = 'ğŸ—„ï¸ Testing Database Tables...\n\n';

      try {
        // Test products table
        const products = await fetch(API_BASE + '/api/ecommerce/products');
        const productsData = await products.json();
        output += `âœ… products table: ${productsData.products ? productsData.products.length : 0} rows\n`;

        // Test categories table
        const categories = await fetch(API_BASE + '/api/ecommerce/categories');
        const categoriesData = await categories.json();
        output += `âœ… categories table: ${categoriesData.categories ? categoriesData.categories.length : 0} rows\n`;

        // Test orders table
        const orders = await fetch(API_BASE + '/api/ecommerce/orders');
        const ordersData = await orders.json();
        output += `âœ… orders table: ${ordersData.orders ? ordersData.orders.length : 0} rows\n`;

        // Test store_settings table
        const settings = await fetch(API_BASE + '/api/ecommerce/settings');
        const settingsData = await settings.json();
        output += `âœ… store_settings table: ${settingsData.settings ? Object.keys(settingsData.settings).length : 0} settings\n`;

        output += '\nğŸ“Š All database tables accessible!';
      } catch (error) {
        output += `âŒ Database Error: ${error.message}`;
      }

      result.textContent = output;
    }

    // Test 4: Full Integration
    async function runFullTest() {
      const result = document.getElementById('fullResult');
      result.style.display = 'block';
      let output = 'ğŸš€ Running Full Integration Test...\n\n';

      try {
        // Step 1: Check functions
        output += '1ï¸âƒ£ Checking JavaScript functions...\n';
        if (typeof loadProducts === 'function') {
          output += '   âœ… Functions loaded\n\n';
        } else {
          output += '   âŒ Functions missing\n\n';
          result.textContent = output;
          return;
        }

        // Step 2: Test APIs
        output += '2ï¸âƒ£ Testing API connectivity...\n';
        const testAPI = await fetch(API_BASE + '/api/ecommerce/products');
        if (testAPI.ok) {
          output += '   âœ… API responding\n\n';
        } else {
          output += '   âŒ API error\n\n';
        }

        // Step 3: Test data loading
        output += '3ï¸âƒ£ Testing data loading...\n';
        const products = await fetch(API_BASE + '/api/ecommerce/products');
        const productsData = await products.json();
        output += `   âœ… Loaded ${productsData.products ? productsData.products.length : 0} products\n\n`;

        // Step 4: Test categories
        output += '4ï¸âƒ£ Testing categories...\n';
        const categories = await fetch(API_BASE + '/api/ecommerce/categories');
        const categoriesData = await categories.json();
        output += `   âœ… Loaded ${categoriesData.categories ? categoriesData.categories.length : 0} categories\n\n`;

        output += 'âœ… FULL INTEGRATION TEST PASSED!\n';
        output += '\nğŸ‰ All systems operational!';
      } catch (error) {
        output += `\nâŒ Test failed: ${error.message}`;
      }

      result.textContent = output;
    }

    // Quick Action: Add Test Product
    async function addTestProduct() {
      const result = document.getElementById('actionResult');
      result.style.display = 'block';
      
      const product = {
        name: 'Test Product ' + Date.now(),
        description: 'This is a test product',
        price: 1000,
        stock_quantity: 50,
        status: 'active',
        category_id: 1
      };

      try {
        const response = await fetch(API_BASE + '/api/ecommerce/products', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(product)
        });
        
        const data = await response.json();
        
        if (data.success) {
          result.textContent = `âœ… Test product added!\n\nID: ${data.id}\nName: ${product.name}`;
        } else {
          result.textContent = `âŒ Failed to add product\n${data.message}`;
        }
      } catch (error) {
        result.textContent = `âŒ Error: ${error.message}`;
      }
    }

    // Quick Action: Add Test Category
    async function addTestCategory() {
      const result = document.getElementById('actionResult');
      result.style.display = 'block';
      
      const category = {
        name: 'Test Category ' + Date.now(),
        description: 'This is a test category',
        icon: 'ğŸ§ª',
        sort_order: 99
      };

      try {
        const response = await fetch(API_BASE + '/api/ecommerce/categories', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(category)
        });
        
        const data = await response.json();
        
        if (data.success) {
          result.textContent = `âœ… Test category added!\n\nID: ${data.id}\nName: ${category.name}`;
        } else {
          result.textContent = `âŒ Failed to add category\n${data.message}`;
        }
      } catch (error) {
        result.textContent = `âŒ Error: ${error.message}`;
      }
    }

    // Quick Action: List Products
    async function listProducts() {
      const result = document.getElementById('actionResult');
      result.style.display = 'block';
      result.textContent = 'Loading products...';

      try {
        const response = await fetch(API_BASE + '/api/ecommerce/products');
        const data = await response.json();
        
        if (data.success && data.products) {
          let output = `ğŸ“¦ Total Products: ${data.products.length}\n\n`;
          data.products.forEach((p, i) => {
            output += `${i + 1}. ${p.name}\n`;
            output += `   Price: Rs. ${p.price}\n`;
            output += `   Stock: ${p.stock_quantity}\n`;
            output += `   Status: ${p.status}\n\n`;
          });
          result.textContent = output || 'No products found';
        } else {
          result.textContent = 'No products found';
        }
      } catch (error) {
        result.textContent = `âŒ Error: ${error.message}`;
      }
    }

    // Quick Action: List Categories
    async function listCategories() {
      const result = document.getElementById('actionResult');
      result.style.display = 'block';
      result.textContent = 'Loading categories...';

      try {
        const response = await fetch(API_BASE + '/api/ecommerce/categories');
        const data = await response.json();
        
        if (data.success && data.categories) {
          let output = `ğŸ“‚ Total Categories: ${data.categories.length}\n\n`;
          data.categories.forEach((c, i) => {
            output += `${i + 1}. ${c.icon || ''} ${c.name}\n`;
            output += `   Products: ${c.product_count || 0}\n`;
            output += `   Description: ${c.description || 'N/A'}\n\n`;
          });
          result.textContent = output || 'No categories found';
        } else {
          result.textContent = 'No categories found';
        }
      } catch (error) {
        result.textContent = `âŒ Error: ${error.message}`;
      }
    }
  </script>

  <!-- Load actual e-commerce JavaScript -->
  <script src="js/ecommerce.js?v=test"></script>
</body>
</html>
